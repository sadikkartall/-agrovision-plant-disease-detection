{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Sol Taraf: Dosya Yükleme -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-upload"></i> Görüntü Yükle
                </h5>
            </div>
            <div class="card-body">
                <form id="predictForm" method="POST" action="{{ url_for('predict_route') }}" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="fileInput" class="form-label">Bitki Yaprak Görüntüsü Seçin</label>
                        <input type="file" 
                               class="form-control" 
                               id="fileInput" 
                               name="file" 
                               accept="image/png,image/jpeg,image/jpg"
                               required>
                        <div class="form-text">
                            Desteklenen formatlar: JPG, JPEG, PNG (Maksimum 10MB)
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success w-100" id="predictBtn">
                        <i class="bi bi-search"></i> Tahmin Yap
                    </button>
                </form>
                
                <!-- Yüklenen Görüntü Önizlemesi -->
                {% if image_base64 %}
                <div class="mt-4">
                    <h6>Yüklenen Görüntü:</h6>
                    <img src="data:image/jpeg;base64,{{ image_base64 }}" 
                         class="img-fluid rounded shadow-sm" 
                         alt="Yüklenen görüntü">
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sağ Taraf: Sonuçlar -->
    <div class="col-lg-6 mb-4">
        {% if has_result %}
        <!-- Tahmin Sonuçları -->
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="bi bi-check-circle"></i> Tahmin Sonucu
                </h5>
            </div>
            <div class="card-body">
                <!-- Ana Tahmin -->
                <div class="text-center mb-4">
                    <h3 class="text-success">{{ prediction }}</h3>
                    <div class="progress" style="height: 30px;">
                        <div class="progress-bar bg-success" 
                             role="progressbar" 
                             style="width: {{ (confidence * 100)|int }}%"
                             aria-valuenow="{{ (confidence * 100)|int }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            <strong>{{ "%.1f"|format(confidence * 100) }}%</strong>
                        </div>
                    </div>
                    <small class="text-muted">Güven Skoru</small>
                </div>

                <!-- Top-3 Tahminler -->
                <div class="mb-3">
                    <h6><i class="bi bi-list-ol"></i> En Yüksek 3 Tahmin:</h6>
                    <ul class="list-group">
                        {% for class_name, prob in top_predictions.items() %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>{{ class_name }}</span>
                            <span class="badge bg-{{ 'success' if loop.index == 1 else 'primary' if loop.index == 2 else 'info' }} rounded-pill">
                                {{ "%.2f"|format(prob * 100) }}%
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <!-- Detaylı İstatistikler (Opsiyonel) -->
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="bi bi-graph-up"></i> Tüm Sınıf Olasılıkları
                </h6>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                <div class="list-group list-group-flush">
                    {% for class_name, prob in all_predictions.items() %}
                    <div class="list-group-item px-0">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <small class="fw-bold">{{ class_name }}</small>
                            <small class="text-muted">{{ "%.2f"|format(prob * 100) }}%</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-info" 
                                 role="progressbar" 
                                 style="width: {{ (prob * 100)|int }}%"
                                 aria-valuenow="{{ (prob * 100)|int }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100">
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% else %}
        <!-- Başlangıç Mesajı -->
        <div class="card shadow-sm">
            <div class="card-body text-center py-5">
                <i class="bi bi-image" style="font-size: 4rem; color: #ccc;"></i>
                <h5 class="mt-3 text-muted">Tahmin Sonuçları Burada Görünecek</h5>
                <p class="text-muted">
                    Sol taraftan bir görüntü yükleyip "Tahmin Yap" butonuna tıklayın.
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Bilgi Kartı -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h6 class="mb-0">
                    <i class="bi bi-info-circle"></i> Proje Hakkında
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="bi bi-database"></i> Veri Seti</h6>
                        <p class="text-muted small">PlantVillage Dataset - 38 sınıf bitki hastalığı</p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-cpu"></i> Model</h6>
                        <p class="text-muted small">MobileNetV2 (Transfer Learning)</p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-tools"></i> Teknoloji</h6>
                        <p class="text-muted small">TensorFlow, Flask, Bootstrap 5</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

